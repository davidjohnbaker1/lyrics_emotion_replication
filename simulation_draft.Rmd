---
title: "Simulation Analysis"
author: "David John Baker"
date: "07/08/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

This document explores the extent that a simulation would have provided insight into the power needed for detecting the effects in our emotion study.
I did it so that I can better understand how simulations work and based it on this [blog post by Nick HK](https://nickch-k.github.io/EconometricsSlides/Week_08/Power_Simulations.html).

Going to be checking for

* Small, medium, and large effects in this Mixed ANOVA
* What variatons we could have expected.
* Sample size 

The money question is simple langauge is:

> Given this design we found in Experiment I, if we teleported back in time and knew we were expecting small, medium, and large effects in our 4x2x2 ANOVA, how much data would we have to collected to find each permutation of this? 

## Step One: Make Up the Data We Want

* Emotion
* Lyrics
* Gender 

```{r}
library(magrittr)
library(ggplot2)
## Online

Subjects<-factor(rep(seq(1,20),each=4))  
# Creates 20 participants worth of data since it makes 4 per participant
# 80 = 20 * 2 * 2 
DV<-rnorm(80,c(100,200,300,400),sd=10)
IV1<-rep(c("level1","level2"),each=2,20)
IV2<-rep(c("level1","level2"),each=1,40)
AllData<-data.frame(DV,IV1,IV2)
AllData

AllData %>%
  group_by(IV1) %>%
  summarise(mean = mean(DV))

#-----------------------------------------------
# Create Subjects
#Subjects<-factor(rep(seq(1,32),each=4))  

# First Create Single Participant of Within Subject Design 

nsubjects <- 32

emotion <-rep(c("happy","sad","calm","angry"), times = 4*nsubjects)
emotion

lyrics <-rep(c("lyrics","nolyrics"),each = 4, times =2*nsubjects )
lyrics

gender <- rep(c("man","woman"), each = 8, times = 1*nsubjects)
gender

means_table_1 <- table_1 %>% 
  select(means, emotions, lyrics, gender) %>%
  arrange(gender, lyrics, emotions) %>%
  pull(means)

values <- rnorm(16*nsubjects, means_table_1, sd = 1.265)

my_data <- data.frame(emotion, lyrics, gender, values)

my_data

my_subjects<-factor(rep(seq(1,nsubjects),each=16))  

my_subjects

my_data %>%
  ggplot(aes(x = emotion, color = lyrics, y = values)) +
  geom_point()

ANOVAresults<-aov(values~emotion*lyrics*gender + Error(my_subjects/(emotion*lyrics)), my_data)

tidy(ANOVAresults)

tabz <- summary(ANOVAresults)

library(broom)
tidy(tabz)

model.tables(ANOVAresults,"means")

```



```{r}
table_1_values <- c(7.85, 8.18, 6.62, 6.91, 
                    5.79, 5.20, 6.51, 6.11, 
                    7.75, 7.95, 4.05, 5.41, 
                    5.00, 4.41, 6.08, 6.59)

grim_test <- function(sample_size, likert_start, likert_end, means){
  integer_values <- sample_size * means
  bottom <- round(floor(integer_values)/ sample_size, 2)
  top <- round(ceiling(integer_values)/ sample_size, 2)
  df <- data.frame(bottom, top, means)
  df$sample_size <- sample_size
  df$possible <- ifelse(df$bottom == means | df$top == means, yes = TRUE,no = FALSE)
  df
}

sd(table_1$means)

table_1 <- grim_test(32, 1, 9, table_1_values)

table_1$gender <- rep(c("woman","man"),8)
table_1$lyrics <- rep(c("no lyric", "no lyric", "lyric","lyric"),4)
table_1$emotions <- c(rep("happy",4), rep("sad",4), rep("calm",4), rep("angry",4))

table_1 <- table_1 %>%
  tibble() %>%
    mutate(valence = case_when(
    emotions == "happy" ~ "positive",
    emotions == "calm" ~ "positive",
    emotions == "angry" ~ "negative",
    emotions == "sad" ~ "negative"
  ))

paper_vector <- table_1 %>%
  select(means, emotions, lyrics, gender) %>%
  arrange(gender, lyrics, emotions) %>%
  pull(means)

experiment_1_function <- function(nsubjects, paper_vector,  sd = 1.265) {
  # Set Number of Subjects
  nsubjects <- 32
  
  # Create Design
  emotion <- rep(c("happy", "sad", "calm", "angry"), times = 4 * nsubjects)
  lyrics <- rep(c("lyrics", "nolyrics"), each = 4, times = 2 * nsubjects)
  gender <- rep(c("man", "woman"), each = 8, times = 1 * nsubjects)
  
  values <- rnorm(16 * nsubjects, means_table_1, sd = sd)
  
  my_data <- data.frame(emotion, lyrics, gender, values)
  
  my_subjects <- factor(rep(seq(1, nsubjects), each = 16))
  
  ANOVAresults <- aov(values ~ emotion * lyrics * gender + Error(my_subjects / (emotion * lyrics)), my_data)
  
  summary_table <- summary(ANOVAresults)
  summary_table
}

experiment_1_function()

```



```{r}
set.seed(16)

simulations <- replicate(n = 100, experiment_1_function(), simplify = FALSE)

for (i in simulations) {
  print(paste("Working on", i))
  print(simulations[[i]])
  
}

```

* Could find SD from the tables I guess 



```{r}
# Create MULTIPLE Subjects (embed code to expand)

# Replicate 




# Establish Means and SD of All Groups (as if singular)
DV<-rnorm(160,c(100,200,400,700),sd= c(1,20,60,200))
DV2 <- rnorm()

rnorm(4, c(7.39,6.29,5.52,5.90), sd = 2)

#-------------------------------------------------
emotions2 <- rep(c("happy","sad","calm","angry"), each = 1,4)
emotions2

AllData2 <- data.frame(DV2, emotions2)

AllData<-data.frame(DV,emotion,lyrics, gender)

AllData

AllData %>%
  group_by(emotion, lyrics) %>%
  summarise(mean = mean(DV))

AllData %>%
  ggplot(aes(x = emotion, y = DV, color = lyrics)) +
  geom_point()


```



* Also make GRIM tables 


```{r setup, include=FALSE}


```

